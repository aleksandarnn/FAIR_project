@prefix sh:      <http://www.w3.org/ns/shacl#> .
@prefix :        <https://w3id.org/FAIR-course-UT/2024-2025/GROUP-5/data#> .
@prefix dcat:    <http://www.w3.org/ns/dcat#> .
@prefix dct:     <http://purl.org/dc/terms/> .
@prefix foaf:    <http://xmlns.com/foaf/0.1/> .
@prefix prov:    <http://www.w3.org/ns/prov#> .
@prefix time:    <http://www.w3.org/2006/time#> .
@prefix locn:    <http://www.w3.org/ns/locn#> .
@prefix xsd:     <http://www.w3.org/2001/XMLSchema#> .
@prefix geosparql: <http://www.opengis.net/ont/geosparql#> .

############################################################
# DATASET SHAPE
############################################################

:DatasetShape
  a sh:NodeShape ;
  sh:targetClass dcat:Dataset ;

  # Title 1..1 literal
  sh:property [
    sh:path dct:title ;
    sh:minCount 1 ; sh:maxCount 1 ;
    sh:datatype xsd:string ;
    sh:maxLength 200 ;
    sh:message "dct:title is required exactly once (≤200 chars)." ;
  ] ;

  # Description 1..1 literal
  sh:property [
    sh:path dct:description ;
    sh:minCount 1 ; sh:maxCount 1 ;
    sh:datatype xsd:string ;
    sh:maxLength 4000 ;
    sh:message "dct:description is required exactly once (≤4000 chars)." ;
  ] ;

  # Creator 1..n Agent
  sh:property [
    sh:path dct:creator ;
    sh:minCount 1 ;
    sh:node :AgentShape ;
    sh:message "Provide at least one dct:creator (Agent)." ;
  ] ;

  # License exactly 1 IRI
  sh:property [
    sh:path dct:license ;
    sh:minCount 1 ; sh:maxCount 1 ;
    sh:nodeKind sh:IRI ;
    sh:message "dct:license must be exactly one IRI (e.g., CC0 URL)." ;
  ] ;

  # Temporal coverage 1..1
  sh:property [
    sh:path dct:temporal ;
    sh:minCount 1 ; sh:maxCount 1 ;
    sh:node :PeriodOfTimeShape ;
    sh:message "Provide one dct:temporal period (start/end dates)." ;
  ] ;

  # Spatial coverage 0..1 
  sh:property [
    sh:path dct:spatial ;
    sh:maxCount 1 ;
    sh:node :LocationShape ;
    sh:message "If present, dct:spatial must give a geometry (WKT)." ;
  ] ;

  # At least one distribution
  sh:property [
    sh:path dcat:distribution ;
    sh:minCount 1 ;
    sh:node :DistributionShape ;
    sh:message "Provide at least one dcat:distribution." ;
  ] ;
.

############################################################
# DISTRIBUTION SHAPE
############################################################

:DistributionShape
  a sh:NodeShape ;
  sh:targetClass dcat:Distribution ;

  # One access or download URL (require downloadURL for this project)
  sh:property [
    sh:path dcat:downloadURL ;
    sh:minCount 1 ; sh:maxCount 1 ;
    sh:nodeKind sh:IRI ;
    sh:message "dcat:downloadURL must be exactly one IRI (raw file URL)." ;
  ] ;

  # Media type or format (we require mediaType)
  sh:property [
    sh:path dcat:mediaType ;
    sh:minCount 1 ; sh:maxCount 1 ;
    sh:datatype xsd:string ;
    sh:message "dcat:mediaType must be present once (e.g., 'text/csv')." ;
  ] ;

  # License exactly 1 IRI
  sh:property [
    sh:path dct:license ;
    sh:minCount 1 ; sh:maxCount 1 ;
    sh:nodeKind sh:IRI ;
    sh:message "Distribution must carry a dct:license IRI (e.g., CC0 URL)." ;
  ] ;
.

############################################################
# AGENT SHAPE (Person or Organization)
############################################################

:AgentShape
  a sh:NodeShape ;

  sh:property [
    sh:path foaf:name ;
    sh:minCount 1 ; sh:maxCount 1 ;
    sh:datatype xsd:string ;
    sh:message "Agent must have foaf:name." ;
  ] ;
.

############################################################
# TEMPORAL SHAPE
############################################################

:PeriodOfTimeShape
  a sh:NodeShape ;

  sh:property [
    sh:path time:hasBeginning ;
    sh:minCount 1 ; sh:maxCount 1 ;
    sh:node :InstantShape ;
    sh:message "Provide time:hasBeginning." ;
  ] ;

  sh:property [
    sh:path time:hasEnd ;
    sh:minCount 1 ; sh:maxCount 1 ;
    sh:node :InstantShape ;
    sh:message "Provide time:hasEnd." ;
  ] ;
.

:InstantShape
  a sh:NodeShape ;
  sh:property [
    sh:path time:inXSDDate ;
    sh:minCount 1 ; sh:maxCount 1 ;
    sh:datatype xsd:date ;
    sh:message "Instant must have time:inXSDDate (xsd:date)." ;
  ] ;
.

############################################################
# LOCATION SHAPE (WKT geometry)
############################################################

:LocationShape
  a sh:NodeShape ;

  sh:property [
    sh:path locn:geometry ;
    sh:minCount 1 ; sh:maxCount 1 ;
    sh:datatype geosparql:wktLiteral ;
    sh:message "locn:geometry must be WKT (e.g., POLYGON ...)." ;
  ] ;
.
